<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hobivia — Explorer</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --vert:#1B4F46; --beige:#EDE6DA; --cta:#D07B4E; --noir:#111315; --blanc:#fff;
    --glass:rgba(255,255,255,.12); --brd:rgba(255,255,255,.28); --shadow:0 10px 30px rgba(0,0,0,.25);
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--noir);color:var(--beige);font-family:Inter,system-ui,Arial,sans-serif}
  a{color:inherit;text-decoration:none}
  .container{min-height:100svh; display:flex; flex-direction:column}

  /* zones */
  #app-header, #app-footer{position:relative; z-index:10}
  #app-main{flex:1; display:flex; flex-direction:column}

  /* loader squelettes */
  .skeleton{position:relative; overflow:hidden; background:rgba(255,255,255,.06); border:1px solid var(--brd); border-radius:18px}
  .skeleton::after{
    content:""; position:absolute; inset:0; transform:translateX(-100%);
    background:linear-gradient(90deg, transparent, rgba(255,255,255,.08), transparent);
    animation: shimmer 1.2s infinite;
  }
  @keyframes shimmer{ 100% { transform:translateX(100%); } }

  .block{padding: clamp(16px, 3vw, 28px)}
  #map-block{margin: clamp(10px, 2vw, 18px); border-radius:20px}
  #list-block{margin: clamp(10px, 2vw, 18px)}

  /* Curseur glass sombre global */
  .glass-cursor{
    position:fixed; left:0; top:0; width:28px; height:28px; border-radius:999px; pointer-events:none; z-index:9999;
    background: radial-gradient(60% 60% at 50% 50%, rgba(255,255,255,.06) 0%, rgba(255,255,255,0) 100%);
    border:1px solid rgba(255,255,255,.18); backdrop-filter: blur(6px);
    transform: translate(-50%,-50%); transition: width .2s ease, height .2s ease, transform .05s linear;
    mix-blend-mode: screen;
  }
  @media (hover:none){ .glass-cursor{ display:none; } }

  /* liens d’ancrage smooth */
  html{scroll-behavior:smooth}
</style>
</head>
<body>
<div class="container">

  <!-- HEADER -->
  <header id="app-header" class="block skeleton" aria-live="polite">Chargement de l’en-tête…</header>

  <!-- MAIN -->
  <main id="app-main">
    <!-- MAP -->
    <section id="map-block" class="block skeleton" aria-label="Carte">Chargement de la carte…</section>

    <!-- LISTE LOGEMENTS -->
    <section id="list-block" class="block skeleton" aria-label="Logements">Chargement des logements…</section>
  </main>

  <!-- FOOTER -->
  <footer id="app-footer" class="block skeleton" aria-live="polite">Chargement du pied de page…</footer>

</div>

<!-- Curseur glass sombre -->
<div class="glass-cursor" id="glassCursor" aria-hidden="true"></div>

<script>
/* ========= Utilitaires ========= */
const $ = (s,ctx=document)=>ctx.querySelector(s);

/* Charge un partial HTML et exécute ses <script> (inline + src) */
async function loadPartial(targetEl, url){
  try{
    const res = await fetch(url, {cache:'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status+' @ '+url);
    const html = await res.text();

    // Injecte le HTML
    targetEl.innerHTML = html;
    targetEl.classList.remove('skeleton');

    // Exécute les <script> du partial
    const tmp = document.createElement('div');
    tmp.innerHTML = html;

    const scripts = Array.from(tmp.querySelectorAll('script'));
    for(const oldScr of scripts){
      const newScr = document.createElement('script');
      // Copie les attributs (src, type, nomodule, async, etc.)
      for(const attr of oldScr.attributes){ newScr.setAttribute(attr.name, attr.value); }
      // Si inline, recopie le contenu
      if(!oldScr.src){ newScr.textContent = oldScr.textContent; }
      // Insère au bon endroit : à la fin du target
      targetEl.appendChild(newScr);
      // Attends les scripts à src si async non spécifié (ordre déterministe)
      if(newScr.src && !newScr.async){
        await new Promise((resolve,reject)=>{
          newScr.onload = resolve; newScr.onerror = reject;
        });
      }
    }
  }catch(err){
    console.error(err);
    targetEl.innerHTML = `
      <div style="padding:16px;border:1px solid var(--brd);border-radius:14px;background:rgba(255,255,255,.06)">
        <strong>Erreur de chargement</strong><br>
        <code>${url}</code><br>
        ${String(err.message || err)}
      </div>`;
    targetEl.classList.remove('skeleton');
  }
}

/* Curseur glass sombre (lissage) */
(function glassCursor(){
  const c = $('#glassCursor');
  let x=0,y=0,tx=0,ty=0;
  const lerp=(a,b,t)=>a+(b-a)*t;
  const raf=()=>{ tx=lerp(tx,x,0.2); ty=lerp(ty,y,0.2); c.style.transform=`translate(${tx}px, ${ty}px) translate(-50%,-50%)`; requestAnimationFrame(raf); };
  window.addEventListener('mousemove',e=>{x=e.clientX;y=e.clientY;},{passive:true});
  raf();
})();

/* Empêche la page de “sauter” si des ancres internes sont cliquées avant injection */
document.addEventListener('click', (e)=>{
  const a = e.target.closest('a[href^="#"]');
  if(!a) return;
  const id = a.getAttribute('href').slice(1);
  const target = document.getElementById(id);
  if(target){ e.preventDefault(); target.scrollIntoView({behavior:'smooth', block:'start'}); }
},{capture:true});

/* ========= Orchestration ========= */
(async function boot(){
  // IMPORTANT : l’ordre ici respecte tes dépendances visuelles
  await loadPartial($('#app-header'), 'partials/header.html');
  await loadPartial($('#map-block'), 'partials/map.html');
  await loadPartial($('#list-block'), 'partials/explorer-list.html');
  await loadPartial($('#app-footer'), 'partials/footer.html');
})();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hobivia – Logement</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet">
<style>
:root{
  --vert-foret:#1B4F46; --beige-sable:#EDE6DA; --terre-cuite:#D07B4E;
  --glass-bg:rgba(255,255,255,0.12); --glass-brd:rgba(255,255,255,0.35);
  --shadow:0 12px 40px rgba(0,0,0,.18);
}
*{box-sizing:border-box} body{margin:0;font-family:Inter,sans-serif;background:var(--beige-sable);color:#222}
.container{max-width:1100px;margin:0 auto;padding:18px}
.glass{background:var(--glass-bg);border:1px solid var(--glass-brd);backdrop-filter:blur(14px);border-radius:22px;box-shadow:var(--shadow)}
.header{display:flex;align-items:center;gap:10px;justify-content:space-between;margin:10px 0}
.header a{color:#0c3f36;text-decoration:none}
.hero{position:relative;border-radius:22px;overflow:hidden;min-height:46vh;display:grid;place-items:end}
.hero img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.9)}
.hero .overlay{position:relative;z-index:1;width:100%;padding:18px}
.title{font-family:"Space Grotesk",sans-serif;color:#f6fbf9;margin:0;text-shadow:0 10px 30px rgba(0,0,0,.35)}
.sub{color:#e8f4f1;margin:6px 0 0}
.actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
.btn{display:inline-flex;align-items:center;gap:.5rem;background:var(--terre-cuite);color:white;border:none;border-radius:999px;padding:.75rem 1.25rem;font-weight:700;cursor:pointer;transition:transform .2s ease}
.btn:hover{transform:translateY(-2px)}
.btn-ghost{background:rgba(255,255,255,.2);color:#fff}
.layout{display:grid;grid-template-columns:1.2fr .8fr;gap:18px;margin-top:18px}
@media(max-width:900px){.layout{grid-template-columns:1fr}}
.block{padding:16px}
h2{font-family:"Space Grotesk",sans-serif;color:#0f493f;margin:0 0 10px}
.meta{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
.badge{background:rgba(255,255,255,.5);border:1px solid var(--glass-brd);border-radius:999px;padding:6px 10px;font-size:.92rem}
.equipements{display:flex;flex-wrap:wrap;gap:8px}
.equipements .tag{background:rgba(255,255,255,.6);border:1px solid var(--glass-brd);border-radius:999px;padding:6px 10px}
.info-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(max-width:640px){.info-grid{grid-template-columns:1fr}}
.info{padding:12px}
.price{font-size:1.5rem;font-weight:800;color:#0f493f}
.gallery{margin-top:14px}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:10px}
.tile{border-radius:14px;overflow:hidden}
.tile img{width:100%;height:100%;object-fit:cover;display:block}
.tile.w6{grid-column:span 6}.tile.w4{grid-column:span 4}.tile.w3{grid-column:span 3}.tile.w5{grid-column:span 5}
.tile.h2{height:220px}.tile.h3{height:300px}.tile.h4{height:380px}
.see-more{margin-top:10px}
.small{font-size:.92rem;color:#0d3b33}
.hidden{display:none}
.footer-note{margin:14px 0 40px;color:#0d3b33}
.pill{display:inline-block;background:#0f493f;color:#eafff8;border-radius:999px;padding:6px 10px;font-weight:700}
.pulse{box-shadow:0 0 0 0 rgba(208,123,78,.6);animation:pulse 1.8s infinite}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(208,123,78,.6)}70%{box-shadow:0 0 0 14px rgba(208,123,78,0)}100%{box-shadow:0 0 0 0 rgba(208,123,78,0)}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <a href="hobivia.html" class="small">← Retour Hobivia</a>
    <span class="pill">Fiche logement</span>
  </div>

  <!-- HERO -->
  <section id="hero" class="hero glass">
    <img id="hero-img" src="" alt="">
    <div class="overlay">
      <h1 id="hero-title" class="title">…</h1>
      <p id="hero-sub" class="sub">…</p>
      <div class="actions">
        <a id="btn-reserver" class="btn pulse" href="#" target="_blank" rel="noopener">Réserver</a>
        <button id="btn-more" class="btn btn-ghost">Voir plus de photos</button>
      </div>
    </div>
  </section>

  <!-- LAYOUT -->
  <section class="layout">
    <!-- COL 1 -->
    <div class="glass block">
      <h2>À propos</h2>
      <p id="short">…</p>
      <div class="meta">
        <span id="badge-type" class="badge"></span>
        <span id="badge-commune" class="badge"></span>
        <span id="badge-notes" class="badge"></span>
      </div>

      <div class="gallery hidden" id="gallery">
        <div class="grid" id="gallery-grid"></div>
      </div>

      <h2 style="margin-top:18px">L’histoire du lieu</h2>
      <div id="long" class="small">…</div>
    </div>

    <!-- COL 2 -->
    <aside class="glass block">
      <h2>Infos clés</h2>
      <div class="info-grid">
        <div class="glass info">
          <div class="small">À partir de</div>
          <div class="price" id="price">—</div>
          <div class="small">/ nuit</div>
        </div>
        <div class="glass info">
          <div class="small">Distance depuis une grande ville</div>
          <div id="travels" class="small">—</div>
        </div>
      </div>

      <h2 style="margin-top:16px">Équipements</h2>
      <div id="equipements" class="equipements"></div>

      <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap">
        <a id="btn-reserver-2" class="btn pulse" href="#" target="_blank" rel="noopener">Réserver maintenant</a>
        <a href="#hero" class="btn btn-ghost">Retour haut</a>
      </div>

      <p class="footer-note">Conseil Hobivia : privilégie l’aube et le crépuscule pour les meilleures conditions de pêche.</p>
    </aside>
  </section>
</div>

<script>
const JSON_URL = "https://raw.githubusercontent.com/Hobivia/website/refs/heads/main/data/hobivia-peche.json";
const qs = new URLSearchParams(location.search);
const id = Number(qs.get("id") || 0);

// Fallback image
const FALLBACK_IMG = "https://images.unsplash.com/photo-1502920917128-1aa500764cbd?q=80&w=1600&auto=format&fit=crop";

function br(text){ return (text||"").split(/\n{2,}/).map(p=>`<p>${p}</p>`).join(""); }

fetch(JSON_URL)
  .then(r => r.json())
  .then(list => {
    if(!Array.isArray(list) || !list.length) throw new Error("Données indisponibles");
    const raw = list[id-1] || list[0]; // id = index+1 depuis la page liste
    // Normalisation
    const l = {
      nom: raw.nom,
      commune: raw.commune,
      type: raw.type || "Hébergement unique",
      photo: (raw.photos && raw.photos[0]) || raw.photo_url || FALLBACK_IMG,
      photos: Array.isArray(raw.photos) ? raw.photos.slice(1,9) : [],
      noteDesign: raw.note_design ?? "—",
      noteLoc: raw.note_localisation ?? "—",
      short: raw.short_desc || "Hébergement sélectionné par Hobivia pour sa localisation et son design.",
      long: raw.long_desc || "Nous compléterons très bientôt cette fiche avec une histoire détaillée du lieu, ses inspirations architecturales et les meilleurs moments pour profiter de l’activité.",
      price: raw.price_from ? `${raw.price_from} €` : "—",
      lien: raw.lien_resa || "#",
      equipements: Array.isArray(raw.equipements) ? raw.equipements : ["Pontoon privé","Espace extérieur","Chauffage","Coin cuisine"],
      travel: raw.travel_times || {"Paris":"—","Lyon":"—","Bordeaux":"—"}
    };

    // HERO
    document.getElementById("hero-img").src = l.photo;
    document.getElementById("hero-title").textContent = l.nom || "Logement Hobivia";
    document.getElementById("hero-sub").textContent = `${l.commune || ""} • ${l.type}`;
    document.getElementById("btn-reserver").href = l.lien;
    document.getElementById("btn-reserver-2").href = l.lien;

    // META
    document.getElementById("short").textContent = l.short;
    document.getElementById("badge-type").textContent = l.type;
    document.getElementById("badge-commune").textContent = l.commune || "France";
    document.getElementById("badge-notes").textContent = `Design ${l.noteDesign}/5 • Localisation ${l.noteLoc}/5`;

    // PRIX & TRAJETS
    document.getElementById("price").textContent = l.price;
    const travels = Object.entries(l.travel).map(([city,time]) => `<div>• ${city} : ${time}</div>`).join("") || "—";
    document.getElementById("travels").innerHTML = travels;

    // EQUIPEMENTS
    const eq = document.getElementById("equipements");
    eq.innerHTML = l.equipements.map(e => `<span class="tag">${e}</span>`).join("");

    // LONG DESC
    document.getElementById("long").innerHTML = br(l.long);

    // GALLERY
    const grid = document.getElementById("gallery-grid");
    if(l.photos.length){
      const sizes = ["w6 h3","w3 h2","w3 h2","w4 h3","w5 h2","w3 h2","w6 h4","w6 h2"];
      l.photos.forEach((url,i)=>{
        const div = document.createElement("div");
        div.className = `tile ${sizes[i % sizes.length]}`;
        div.innerHTML = `<img src="${url}" onerror="this.src='${FALLBACK_IMG}'">`;
        grid.appendChild(div);
      });
    } else {
      document.getElementById("gallery").classList.add("hidden");
    }

    // VOIR PLUS (affiche/masque la galerie)
    const btnMore = document.getElementById("btn-more");
    btnMore.addEventListener("click", ()=>{
      const gal = document.getElementById("gallery");
      gal.classList.toggle("hidden");
      btnMore.textContent = gal.classList.contains("hidden") ? "Voir plus de photos" : "Masquer les photos";
    });
  })
  .catch(err => {
    document.body.innerHTML = "<div class='container'><p>Impossible de charger cette fiche logement.</p></div>";
    console.error(err);
  });
</script>
</body>
</html>
